

@using System;
@using System.Web;
@using Microsoft.AspNetCore.Html; @*For using HTML in strings*@

@model SuperPortlandListings.Models.ListingsModel;

@{
    ViewData["Title"] = "Listings";
    var searchResults = ViewData["searchResults"];
    string searchCity = "" + ViewData["searchCity"];
    string searchPriceRange = "" + ViewData["searchPriceRange"];
    string searchByOptions = "" + ViewData["searchByOptions"];
    string displayAll = "" + ViewData["displayAll"];


    listing listing0 = new listing("Cheery Neigborhood House", "zero", "Hillsboro", "22110 SW Hillsboro 97123", "$450,000", "January 15, 2020", "2005", "2500", "5000", "4", "2", "2",
        "Cheery Neigborhood House", "This house is great. You should visit it and buy it if you like it.");
    listing listing1 = new listing("Perfect for Families", "one", "Hillsboro", "22111 SW Hillsboro 97123", "$460,000", "January 6, 2020", "2005", "2800", "5000", "4", "2", "2",
        "Perfect for Families", "This house is great. You should visit it and buy it if you like it.");
    listing listing2 = new listing("One Story Southwestern Style Home", "two", "Hillsboro", "22112 SW Hillsboro 97123", "$389,000", "January 12, 2020", "2005", "2100", "5000", "4", "2", "2",
        "One Story Southwestern Style Home", "This house is great. You should visit it and buy it if you like it.");
    listing listing3 = new listing("Big Front Yard with this Home", "three", "Hillsboro", "22110 SW Hillsboro 97123", "$620,000", "January 12, 2020", "2005", "2500", "5000", "4", "2", "2",
        "Big Front Yard with this Home", "This house is great. You should visit it and buy it if you like it.");

    listing listing4 = new listing("Perfect for Growing Families", "four", "Forest Grove", "22111 SW Forest Grove 97116", "$451,000", "January 19, 2020", "2005", "3200", "5000", "4", "2", "2",
        "Perfect for Growing Families", "This house is great. You should visit it and buy it if you like it.");
    listing listing5 = new listing("Charming One Story Home", "five", "Forest Grove", "22112 SW Forest Grove 97116", "$395,000", "January 11, 2020", "2005", "1850", "5000", "4", "2", "2",
        "Charming One Story Home", "This house is great. You should visit it and buy it if you like it.");

    listing listing6 = new listing("New House, Refined Look", "six", "Cornelius", "22110 SW Cornelius 97113", "$449,000", "January 11, 2020", "2005", "2400", "5000", "4", "2", "2",
        "New House, Refined Look", "This house is great. You should visit it and buy it if you like it.");
    listing listing7 = new listing("Perfect for Families", "seven", "Cornelius", "22111 SW Cornelius 97113", "$471,000", "January 25, 2020", "2005", "2500", "5000", "4", "2", "2",
        "Perfect for Families", "This house is great. You should visit it and buy it if you like it.");


    List<listing> theListings = new List<listing>();
    theListings.Add(listing0);
    theListings.Add(listing1);
    theListings.Add(listing2);
    theListings.Add(listing3);
    theListings.Add(listing4);
    theListings.Add(listing5);
    theListings.Add(listing6);
    theListings.Add(listing7);

    List<listing> reorderedListings = new List<listing>();
    List<listing> finalListings = new List<listing>();

}
<div class="content-row">
    <div class="col-sma-3">
        <h2>Listings</h2>
        <p>A home perfect for you.  Call a friendly agent at 503-272-3322.</p>
    </div>
    <div class="col-sma-9">
        <div class="search-listings">
            <h3>Search Listings</h3>
            <form id="searchListings" class="search-listings" method="post">
                <div class="search-listings__subsection">
                    <label class="search-listings__label" for="searchCity">City</label>
                    <select id="searchCity" name="searchCity">
                        <option value=""></option>
                        <option value="Aloha">Aloha</option>
                        <option value="Beaverton">Beaverton</option>
                        <option value="Cornelius">Cornelius</option>
                        <option value="Forest Grove">Forest Grove</option>
                        <option value="Hillsboro">Hillsboro</option>
                    </select>
                </div>
                <div class="search-listings__subsection">
                    <label class="search-listings__label" for="searchPriceRange">Price Range</label>
                    <select id="searchPriceRange" name="searchPriceRange">
                        <option value=""></option>
                        <option value="Under $200,000">Under $200,000</option>
                        <option value="$200,000 - $399,999">$200,000 - $399,999</option>
                        <option value="$400,000 - $599,999">$400,000 - $599,999</option>
                        <option value="$600,000 - $799,999">$600,000 - $799,999</option>
                        <option value="$800,000 - $999,999">$800,000 - $999,999</option>
                        <option value="$1 Million+">$1 Million+</option>
                    </select>
                </div>
                <div class="search-listings__subsection">
                    <label class="search-listings__label" for="searchByOptions">Order By</label>
                    <select id="searchByOptions" name="searchByOptions">
                        <option value=""></option>
                        <option value="PriceAsc">Price low to high</option>
                        <option value="PriceDesc">Price high to low</option>
                        <option value="HouseSizeAsc">House Size low to high</option>
                        <option value="HouseSizeDesc">House Size high to low</option>
                    </select>
                </div>
                <div class="search-listings__subsection">
                    <input type="submit" class="search-listings__search" asp-page-handler="ListingsCitySection" value="Search" />
                </div>
                <div class="search-listings__subsection">
                    <input type="submit" id="searchListingsShowAll" name="searchListingsShowAll" class="search-listings__show-all" asp-page-handler="ListingsShowAllSection" value="Show All" />
                </div>
                <div class="clear-both"></div>
                <div class="search-listings__search-response">
                    @(new HtmlString("" + @searchResults))
                </div>
                <div class="clear-both"></div>
            </form>
        </div>
    </div>
</div>

<div class="content-row">
    <h3 class="listings__content-subtitle">Search Results</h3>

    @{
        if (searchByOptions == "PriceAsc")
        {
            reorderedListings = theListings.OrderBy(theListings => theListings.price).ToList();
        }
        else if (searchByOptions == "PriceDesc")
        {
            reorderedListings = theListings.OrderByDescending(theListings => theListings.price).ToList();
        }
        else if (searchByOptions == "HouseSizeAsc")
        {
            reorderedListings = theListings.OrderBy(theListings => theListings.homeSquareFootage).ToList();
        }
        else if (searchByOptions == "HouseSizeDesc")
        {
            reorderedListings = theListings.OrderByDescending(theListings => theListings.homeSquareFootage).ToList();
        }
        else
        {
            reorderedListings = theListings;
        }
    }


    @for (var i = 0; i < reorderedListings.Count; i++)
    {
        if (@searchCity == "" && @searchPriceRange == "")
        {
            finalListings.Add(reorderedListings[i]);
        }
        else if (@searchCity == reorderedListings[i].city && @searchPriceRange == "")
        {
            finalListings.Add(reorderedListings[i]);
        }
        else if (@searchPriceRange != "")
        {
            bool validListing = true;

            if (@searchCity != "" && @searchCity != reorderedListings[i].city)
            {
                validListing = false;
            }


            if (validListing)
            {
                decimal listingPrice = Convert.ToDecimal(reorderedListings[i].price.Replace("$", ""));

                if (@searchPriceRange == "Under $200,000")
                {
                    if (listingPrice < 200000)
                    {
                        finalListings.Add(reorderedListings[i]);
                    }
                }
                else if (@searchPriceRange == "$200,000 - $399,999")
                {
                    if (listingPrice >= 200000 && listingPrice < 400000)
                    {
                        finalListings.Add(reorderedListings[i]);
                    }
                }
                else if (@searchPriceRange == "$400,000 - $599,999")
                {
                    if (listingPrice >= 400000 && listingPrice < 600000)
                    {
                        finalListings.Add(reorderedListings[i]);
                    }
                }
                else if (@searchPriceRange == "$600,000 - $799,999")
                {
                    if (listingPrice >= 600000 && listingPrice < 800000)
                    {
                        finalListings.Add(reorderedListings[i]);
                    }
                }
                else if (@searchPriceRange == "$800,000 - $999,999")
                {
                    if (listingPrice >= 800000 && listingPrice < 1000000)
                    {
                        finalListings.Add(reorderedListings[i]);
                    }
                }
                else if (@searchPriceRange == "$1 Million+")
                {
                    if (listingPrice >= 1000000)
                    {
                        finalListings.Add(reorderedListings[i]);
                    }
                }
            }
        }

    }


    @for (var i = 0; i < finalListings.Count; i++)
    {
        <div class="col-sma-6 col-lar-4 house-container @finalListings[i].classCSS">
            <div class="house-container__image-container">
                <div class="house-container__image"></div>
            </div>
            <div class="house-container__non-bg-content">
                <div class="house-container__title">@finalListings[i].name</div>
                <div class="house-container__cost">@finalListings[i].price</div>
                <div class="house-container__label">NEW</div>
                <div class="house-container__details">
                    <div class="house-container__details__beds">@finalListings[i].numberOfBedrooms bd</div>
                    <div class="house-container__details__baths">@finalListings[i].numberOfBathrooms ba</div>
                    <div class="house-container__details__parking-spaces">@finalListings[i].parkingSpaces car</div>
                    <div class="house-container__details__year-built">Built: @finalListings[i].yearBuilt</div>
                    <div class="house-container__detials__house-size">Home: @finalListings[i].homeSquareFootage ft&sup2;</div>
                    <div class="house-container__detials__lot-size">Lot: @finalListings[i].lotSquareFootage ft&sup2;</div>
                </div>
                <div class="house-container__location">@finalListings[i].address</div>
                <div class="house-container__description">@finalListings[i].description</div>
            </div>
        </div>
    }
</div>

<script type="text/javascript">
    for (let i = 0; i < 8; i++) {
        document.getElementsByClassName("house-container__image")[i].addEventListener("mouseover", function () {
            addHoverClass(i);
        });

        document.getElementsByClassName("house-container__image")[i].addEventListener("mouseout", function () {
            addOutClass(i);
        });
    }

    function addHoverClass(itemNumber) {
        document.getElementsByClassName("house-container__image")[itemNumber].classList.toggle("over");
        document.getElementsByClassName("house-container__image")[itemNumber].classList.remove("out");
    }

    function addOutClass(itemNumber) {
        document.getElementsByClassName("house-container__image")[itemNumber].classList.remove("over");
        document.getElementsByClassName("house-container__image")[itemNumber].classList.toggle("out");
    }
</script>
